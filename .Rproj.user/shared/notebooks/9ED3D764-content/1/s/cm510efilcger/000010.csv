"0","library(plumber)"
"0","# logging"
"0","library(logger)"
"0",""
"0","# Specify how logs are written"
"0","log_dir <- ""logs"""
"0","if (!fs::dir_exists(log_dir)) fs::dir_create(log_dir)"
"0","log_appender(appender_tee(tempfile(""plumber_"", log_dir, "".log"")))"
"0","pr <- plumber::plumb(""./tkutest/plumber.R"")"
"0",""
"0","convert_empty <- function(string) {"
"0","  if (string == """") {"
"0","    ""-"""
"0","  } else {"
"0","    string"
"0","  }"
"0","}"
"0",""
"0","pr$registerHooks("
"0","  list("
"0","    preroute = function() {"
"0","      # Start timer for log info"
"0","      tictoc::tic()"
"0","    },"
"0","    postroute = function(req, res) {"
"0","      end <- tictoc::toc(quiet = TRUE)"
"0","      # Log details about the request and the response"
"0","      # TODO: Sanitize log details - perhaps in convert_empty"
"0","      log_info('{convert_empty(req$REMOTE_ADDR)} ""{convert_empty(req$HTTP_USER_AGENT)}"" {convert_empty(req$HTTP_HOST)} {convert_empty(req$REQUEST_METHOD)} {convert_empty(req$PATH_INFO)} {convert_empty(res$status)} {round(end$toc - end$tic, digits = getOption(""digits"", 5))}')"
"0","    }"
"0","  )"
"0",")"
"0","pr$run()"
"1","INFO [2020-10-13 18:11:57] 127.0.0.1 ""Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) QtWebEngine/5.12.1 Chrome/69.0.3497.128 Safari/537.36"" 127.0.0.1:7167 GET /echo 200 0"
"1","
"
"2","
"
